#!/usr/bin/env bash

declare PLUGIN_PATH="$PLUGIN_AVAILABLE_PATH/githook"
declare retrieveWebhookId=""
declare retrieveRepositoryShort=""

storeHook() {
	declare webhook=$1
	declare webhookId=$2
	declare repositoryShort=$3
	echo "$webhook $webhookId $repositoryShort" >> "$PLUGIN_PATH/data/hooks"
}

hookExist() {
	declare webhook=$1

	# Checks to see if webhook is already in local data file
	while read hookLine; do

		# Turn each line into array because the format 
		# is in "$webhook $webhookId $repositoryShort"
		declare hookArr=($hookLine)
		[[ $webhook == ${hookArr[0]} ]] && return 0
	done < "$PLUGIN_PATH/data/hooks"
	return 1
}

getHookId() {
	# Similar logic to "canAddHook", assigns a webhook id when found
	declare webhook=$1
	while read hook; do
		declare hookArr=($hook)
		if [[ $webhook == ${hookArr[0]} ]] 
		then
			retrieveWebhookId=${hookArr[1]}
			retrieveRepositoryShort=${hookArr[2]}
			return 0
		fi
	done < "$PLUGIN_PATH/data/hooks"
	return 1
}

deleteHook() {
	declare webhook=$1
	sed -i "/$webhook /d" "$PLUGIN_PATH/data/hooks"
}